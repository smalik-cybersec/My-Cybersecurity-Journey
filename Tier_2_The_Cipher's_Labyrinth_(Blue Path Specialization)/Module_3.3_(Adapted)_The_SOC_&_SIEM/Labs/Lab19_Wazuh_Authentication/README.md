# Lab 19: First Contact - Analyzing Authentication Logs

### **Objective**

This lab demonstrates the use of a Wazuh SIEM to detect and analyze user authentication events on a monitored Linux endpoint.

### **Lab Architecture**

- **SIEM Manager:** A virtual machine named `Wazuh-Manager-DVC` running the Wazuh security platform.
- **Monitored Endpoint:** A virtual machine named `Monitored-Endpoint-DVC` running Ubuntu Server with a Wazuh agent installed.

### **Execution Steps**

On the monitored endpoint, the following actions were performed to generate security events:

1. Three failed authentication attempts were generated by trying to switch to the `root` user: `su - root`.
2. One successful authentication event was generated by switching to a valid user: `su - shahid`.

### **Evidence of Analysis**

*Instructions for Shahid: Capture screenshots from your Wazuh dashboard for the following and embed them here. Make sure your screenshots are clear and cropped to the relevant information.*

**1. Screenshot of a Failed Authentication Alert**
*(Embed your screenshot showing the expanded "Authentication failure" event, highlighting fields like `rule.description`, `agent.name`, and `data.dstuser`)*

**2. Screenshot of a Successful Authentication Alert**
*(Embed your screenshot showing the expanded successful login event.)*

### **Analysis and Conclusion**

-

1. **Severity Comparison:**
    - **Failed Authentication (Level 5):**  A failed authentication attempt (especially a single one) is categorized at level 5. This indicates a user-generated error or a potential misuse of credentials. While not necessarily an immediate threat, it warrants monitoring, as a high number of these alerts could indicate a brute-force attack.
    - **Successful Authentication (Level 3):**  A successful authentication is assigned a lower severity of level 3 because, in most cases, it represents a legitimate and expected event.
2. **The Analyst's Mindset:**
    - **Single Authentication Failure:**  A single authentication failure alert might not be an immediate cause for alarm. Users sometimes mistype passwords or have forgotten them.
    - **Multiple Authentication Failures from the Same Source:**  However, 100 authentication failures from the same source IP address in under a minute is a significant indicator of a brute-force attack.
3. **Ground Truth:**
    - The  `full_log`  field contains the raw, unprocessed log data from the event source, such as the operating system or application. It is often unstructured and hard for a human to interpret directly.
    - **Wazuh's Role:**  The Wazuh Manager's crucial role is to  **decode and analyze**  these raw logs. It performs the following steps:
        - **Pre-decoding:**  The log is initially parsed to extract basic information like the timestamp, hostname, and program name.
        - **Decoding:**  Decoders, either pre-built or custom-defined, parse the raw log text to extract specific fields and values, such as  `data.dstuser`  (destination user) and  `data.srcip`  (source IP address).
        - **Rule Matching:**  The decoded information is then compared against a set of rules. When a rule matches a specific pattern or behavior in the log, it triggers an alert and generates the  `rule.description`, which provides a concise and human-readable summary of the event.
    - This decoding and analysis process transforms cryptic log data into structured, meaningful information, making the analyst's job significantly easier by providing context and actionable insights.*

- **Alert Severity:** A failed authentication (`Level 5`) is considered more severe than a successful one (`Level 3`) because it represents an anomaly and a potential indicator of malicious activity, such as a brute-force attempt. A successful login is typically expected, informational behavior.

- **Pattern Analysis:** A single failed login is a low-priority event, likely a user error. However, a high volume of failed logins from a single source IP address would be a critical alert, indicating a coordinated brute-force attack. A SIEM is crucial for identifying these patterns through event correlation.

- **SIEM Value (Log Parsing):** The Wazuh manager adds immense value by parsing cryptic raw logs (as seen in the `full_log` field) and normalizing them into structured, searchable fields (`data.dstuser`, `rule.description`, etc.). This process transforms unusable data into actionable intelligence, dramatically accelerating an analyst's workflow.
